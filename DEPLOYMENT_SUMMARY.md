# –î–µ–ø–ª–æ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π commission_rate –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–í –æ—Ç—á–µ—Ç–µ –ø–æ –ö–í –¥–ª—è —Å—Ç—Ä–∞—Ö–æ–≤—â–∏–∫–∞ –í–°–ö (–∏ –¥—Ä—É–≥–∏—Ö) –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —Å—Ç–æ–ª–±—Ü–µ "–ö–í %" –±—ã–ª–∏ —Ä–∞–≤–Ω—ã 0.

**–ü—Ä–∏—á–∏–Ω–∞:** –£ 121 –ø–ª–∞—Ç–µ–∂–∞ –Ω–µ –±—ã–ª–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª–µ `commission_rate`.

## üîß –†–µ—à–µ–Ω–∏–µ

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (4 —Ñ–∞–π–ª–∞):
1. `apps/policies/signals.py` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ commission_rate
2. `apps/policies/admin.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–∏—Å–∞
3. `apps/reports/exporters.py` - —É–¥–∞–ª–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
4. `apps/reports/views.py` - —É–¥–∞–ª–µ–Ω –∏–º–ø–æ—Ä—Ç

### –°–∫—Ä–∏–ø—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö:
- `fix_all_missing_commission_rates.py` - –∏—Å–ø—Ä–∞–≤–∏—Ç –≤—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –±–µ–∑ commission_rate

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–Ω

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ù–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–µ:
cd /path/to/project
source venv/bin/activate
./deploy_commission_fix.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π

```bash
# 1. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# 2. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø –±–∞–∑—ã
# PostgreSQL:
pg_dump -U db_user -d db_name > backup_$(date +%Y%m%d_%H%M%S).sql
# SQLite:
cp db.sqlite3 db.sqlite3.backup_$(date +%Y%m%d_%H%M%S)

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
sudo systemctl restart gunicorn
# –∏–ª–∏
docker-compose restart web

# 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
python fix_all_missing_commission_rates.py
# –í–≤–µ–¥–∏—Ç–µ: –¥–∞

# 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
# –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω–∫—É ‚Üí –û—Ç—á–µ—Ç—ã ‚Üí –û—Ç—á–µ—Ç –ø–æ –ö–í ‚Üí –í–°–ö
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤ —Å—Ç–æ–ª–±—Ü–µ "–ö–í %" –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ 0)
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:
- ‚úÖ –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ –±—É–¥—É—Ç –∏–º–µ—Ç—å commission_rate
- ‚úÖ –û—Ç—á–µ—Ç –ø–æ –ö–í –ø–æ–∫–∞–∂–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚úÖ –ù–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏ –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—Ç—å commission_rate
- ‚úÖ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–∏—Å–æ–≤ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—Å—è

## ‚è±Ô∏è –í—Ä–µ–º—è: ~10 –º–∏–Ω—É—Ç

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
git checkout <previous-commit>
sudo systemctl restart gunicorn
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–∞–∑—É –∏–∑ –±—ç–∫–∞–ø–∞
```
