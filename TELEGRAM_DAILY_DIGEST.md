# Telegram Daily Digest - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –æ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ Telegram –∫–∞–Ω–∞–ª.

## üéØ –ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç

### üë• **–õ–æ–≥–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
- –í—Ä–µ–º—è –≤—Ö–æ–¥–∞ –≤ —Å–∏—Å—Ç–µ–º—É (–ø–æ –º–æ—Å–∫–æ–≤—Å–∫–æ–º—É –≤—Ä–µ–º–µ–Ω–∏)
- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –¢–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ –≤—Ö–æ–¥—ã

### üìã **–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∏—Å–æ–≤:**
- **–°–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–æ–ª–∏—Å—ã** - –Ω–æ–≤—ã–µ –ø–æ–ª–∏—Å—ã –∑–∞ —Å—É—Ç–∫–∏
- **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª–∏—Å—ã** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª–∏—Å–æ–≤
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≥—Ä–∞—Ñ–∏–∫–∞—Ö –ø–ª–∞—Ç–µ–∂–µ–π

### üìä **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –ø–æ–ª–∏—Å—É:**
- –ù–æ–º–µ—Ä –ø–æ–ª–∏—Å–∞
- –õ–∏–∑–∏–Ω–≥–æ–ø–æ–ª—É—á–∞—Ç–µ–ª—å (–Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏)
- –°—Ç—Ä–∞—Ö–æ–≤—â–∏–∫
- –ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–ª–∏—Å: `https://polis.insflow.ru/policies/{id}/`

## ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ

**–ï–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 6:00 –ú–°–ö** (3:00 UTC) - –æ—Ç—á–µ—Ç –∑–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—É—Ç–∫–∏

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Django Management Command:
```bash
# –û–±—ã—á–Ω—ã–π –¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ –≤—á–µ—Ä–∞
python manage.py daily_digest

# –î–∞–π–¥–∂–µ—Å—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É
python manage.py daily_digest --date 2024-12-22

# –¢–µ—Å—Ç–æ–≤—ã–π –¥–∞–π–¥–∂–µ—Å—Ç –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞
python manage.py daily_digest --test
```

### Cron –∑–∞–¥–∞—á–∞:
```bash
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6:00 –ú–°–ö
0 3 * * * cd /root/insurance_broker && docker-compose -f docker-compose.prod.yml exec -T web python manage.py daily_digest >> /root/insurance_broker/logs/daily-digest.log 2>&1
```

## üì± –ü—Ä–∏–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏—è

```
üìä –î–∞–π–¥–∂–µ—Å—Ç –∑–∞ 22.12.2024

üë• –õ–û–ì–ò–ù–´:
‚Ä¢ 08:30 - manager_ivan
‚Ä¢ 09:15 - agent_maria
‚Ä¢ 14:20 - admin_user

üìã –ü–û–õ–ò–°–´:

üÜï –°–æ–∑–¥–∞–Ω—ã:
‚Ä¢ –û–°–ê–ì–û-2024-001 | –û–û–û "–†–æ–º–∞—à–∫–∞" | –†–æ—Å–≥–æ—Å—Å—Ç—Ä–∞—Ö
  üëâ https://polis.insflow.ru/policies/123/

‚úèÔ∏è –ò–∑–º–µ–Ω–µ–Ω—ã:
‚Ä¢ –ö–ê–°–ö–û-2024-055 | –ò–ü –ü–µ—Ç—Ä–æ–≤ | –ê–ª—å—Ñ–∞–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ
  üëâ https://polis.insflow.ru/policies/456/

üí∞ –ò–∑–º–µ–Ω–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–∏:
‚Ä¢ –î–ú–°-2024-033 | –û–û–û "–õ–∏–ª–∏—è" | –í–°–ö
  üëâ https://polis.insflow.ru/policies/789/
  üí≥ –ü–ª–∞—Ç–µ–∂–µ–π –∏–∑–º–µ–Ω–µ–Ω–æ: 2
```

## üîç –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö

### **Django AuditLog:**
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π Policy –∏ PaymentSchedule
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–º, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –≤–Ω–µ—Å –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –î–µ—Ç–∞–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (—á—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ)

### **LoginAttempt –º–æ–¥–µ–ª—å:**
- –£—Å–ø–µ—à–Ω—ã–µ –≤—Ö–æ–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –í—Ä–µ–º—è –≤—Ö–æ–¥–∞, IP –∞–¥—Ä–µ—Å, –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–µ –∂–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram —á—Ç–æ –∏ —Å–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫:
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_CHAT_ID`
- `TELEGRAM_ENABLED`

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
–õ–æ–≥–∏ –∫–æ–º–∞–Ω–¥—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `/root/insurance_broker/logs/daily-digest.log`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–¢–µ—Å—Ç–æ–≤—ã–π –¥–∞–π–¥–∂–µ—Å—Ç:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /root/insurance_broker
docker-compose -f docker-compose.prod.yml exec web python manage.py daily_digest --test
```

### **–î–∞–π–¥–∂–µ—Å—Ç –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É:**
```bash
docker-compose -f docker-compose.prod.yml exec web python manage.py daily_digest --date 2024-12-22
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ cron –∑–∞–¥–∞—á–∏:**
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä crontab
crontab -l | grep daily_digest

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f /root/insurance_broker/logs/daily-digest.log
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### **–î–∞–π–¥–∂–µ—Å—Ç –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron –∑–∞–¥–∞—á—É: `crontab -l`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f logs/daily-digest.log`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram: `./scripts/telegram-notify.sh test`

### **–ü—É—Å—Ç—ã–µ –¥–∞–π–¥–∂–µ—Å—Ç—ã:**
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –µ—Å–ª–∏ –∑–∞ —Å—É—Ç–∫–∏ –Ω–µ –±—ã–ª–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –î–∞–π–¥–∂–µ—Å—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–µ—Ç–∫–æ–π "–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏"

### **–û—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—à–∏–±–æ–∫ Django
docker-compose -f docker-compose.prod.yml logs web | grep daily_digest

# –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
docker-compose -f docker-compose.prod.yml exec web python manage.py daily_digest --test
```

## üìà –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º –ø–æ–ª–∏—Å–æ–≤
- –°—É–º–º—ã –ø—Ä–µ–º–∏–π –ø–æ –Ω–æ–≤—ã–º –ø–æ–ª–∏—Å–∞–º
- –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ —Ñ–∏–ª–∏–∞–ª–∞–º

### **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç—Ä–∞—Ö–æ–≤—â–∏–∫–∞–º
- –¶–≤–µ—Ç–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (—ç–º–æ–¥–∑–∏)
- –ö—Ä–∞—Ç–∫–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ –Ω–∞—á–∞–ª–µ

### **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:**
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç—É –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ –∏ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç—ã –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 6:00 –ú–°–ö!
